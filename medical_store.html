<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Store Management System</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 25%, #81c784 50%, #4caf50 75%, #2e7d32 100%);
            background-attachment: fixed;
        }
        .container-shadow {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        .card-bg {
            background-color: rgba(240, 255, 240, 0.95);
            backdrop-filter: blur(10px);
        }
        input, select, textarea {
            border: 1px solid #d1d5db;
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            background-color: #f9fafb;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.25);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #4caf50;
        }
        .btn-primary:hover {
            background-color: #388e3c;
        }
        .btn-secondary {
            background-color: #6b7280;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .btn-danger {
            background-color: #ef4444;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            color: #4b5563;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .nav-item:hover, .nav-item.active {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        .nav-item svg {
            margin-right: 0.75rem;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6">

    <!-- Landing Page -->
    <div id="landing-page" class="flex flex-col items-center justify-center text-center p-8 w-full max-w-2xl">
        <h1 class="text-5xl font-bold text-gray-800 mb-4">MediGo</h1>
        <p class="text-lg text-gray-600 mb-8">Your simple and elegant solution for tracking medicine inventory in real-time.</p>
        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="signup-page-btn" class="btn btn-primary text-xl px-8 py-4 animate-bounce">
                Sign Up
            </button>
            <button id="login-page-btn" class="btn btn-secondary text-xl px-8 py-4">
                Log In
            </button>
        </div>
    </div>

    <!-- Sign Up Page -->
    <div id="signup-page" class="max-w-md w-full mx-auto container-shadow rounded-xl p-6 md:p-10 card-bg hidden">
        <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">Sign Up</h2>
        <form id="signup-form">
            <div class="mb-4">
                <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                <input type="text" id="signup-name" name="name" required class="w-full">
            </div>
            <div class="mb-4">
                <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="signup-email" name="email" required class="w-full">
            </div>
            <div class="mb-4">
                <label for="signup-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input type="tel" id="signup-phone" name="phone" class="w-full">
            </div>
            <div class="mb-6">
                <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="signup-password" name="password" required class="w-full">
            </div>
            <button type="submit" class="btn btn-primary w-full">Sign Up</button>
        </form>
    </div>

    <!-- Log In Page -->
    <div id="login-page" class="max-w-md w-full mx-auto container-shadow rounded-xl p-6 md:p-10 card-bg hidden">
        <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">Log In</h2>
        <form id="login-form">
            <div class="mb-4">
                <label for="login-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                <input type="text" id="login-name" name="name" required class="w-full">
            </div>
            <div class="mb-6">
                <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="login-password" name="password" required class="w-full">
            </div>
            <button type="submit" class="btn btn-primary w-full">Log In</button>
        </form>
    </div>

    <!-- Main Application Container (Multi-page) -->
    <div id="main-app" class="w-full mx-auto container-shadow rounded-xl p-4 sm:p-6 card-bg flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 hidden min-h-[80vh]">
        
        <!-- Sidebar Navigation -->
        <aside class="md:w-64 bg-green-100 rounded-lg p-4 container-shadow">
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold text-green-700">MediGo</h1>
            </div>
            <nav>
                <a href="#" class="nav-item active" data-page="dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                    </svg>
                    Dashboard
                </a>
                <a href="#" class="nav-item mt-2" data-page="inventory">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 5a2 2 0 012-2h2a2 2 0 012 2v2H4V5zM4 17a2 2 0 002 2h2a2 2 0 002-2v-2H4v2zM4 11a2 2 0 012-2h2a2 2 0 012 2v2H4v-2zM14 17a2 2 0 002-2h2a2 2 0 002 2v2H14zM14 11a2 2 0 012-2h2a2 2 0 012 2v2H14v-2zM14 5a2 2 0 002-2h2a2 2 0 002 2v2H14V5zM10 9a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V9zM10 17a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2z" />
                    </svg>
                    Inventory
                </a>
                <a href="#" class="nav-item mt-2" data-page="sales">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4 4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4z" />
                        <path fill-rule="evenodd" d="M18 9a2 2 0 012 2v4a2 2 0 01-2 2h-4a2 2 0 01-2-2v-4a2 2 0 012-2h4zm-4 4a1 1 0 102 0 1 1 0 00-2 0z" clip-rule="evenodd" />
                        <path fill-rule="evenodd" d="M4 9a2 2 0 012 2v4a2 2 0 01-2 2h-4a2 2 0 01-2-2v-4a2 2 0 012-2h4zm-4 4a1 1 0 102 0 1 1 0 00-2 0z" clip-rule="evenodd" />
                    </svg>
                    Sales
                </a>
                <a href="#" class="nav-item mt-2" data-page="reports">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 2a1 1 0 00-1 1v2a1 1 0 002 0V3a1 1 0 00-1-1z" clip-rule="evenodd" />
                        <path d="M4.35 15.396A6.983 6.983 0 0110 3a7.001 7.001 0 017 7c0 2.275-1.127 4.316-2.85 5.396L14.71 18H5.29l-1.94-2.604z" />
                    </svg>
                    Reports
                </a>
            </nav>
            <div class="mt-8">
                <button id="logout-btn" class="nav-item w-full justify-center btn-danger text-sm">
                    Log Out
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            
            <!-- Dashboard Page Content -->
            <div id="dashboard-page-content" class="page-content">
                <header class="text-center md:text-left mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Dashboard Overview</h1>
                    <p class="mt-2 text-gray-600">A quick glance at your medical store's key metrics.</p>
                </header>

                <!-- Dashboard Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="card-bg p-6 rounded-lg container-shadow text-center">
                        <p class="text-sm text-gray-500">Total Medicines</p>
                        <p id="total-medicines" class="text-3xl font-bold text-green-700 mt-1">0</p>
                    </div>
                    <div class="card-bg p-6 rounded-lg container-shadow text-center">
                        <p class="text-sm text-gray-500">Total Stock</p>
                        <p id="total-stock" class="text-3xl font-bold text-green-700 mt-1">0</p>
                    </div>
                    <div class="card-bg p-6 rounded-lg container-shadow text-center">
                        <p class="text-sm text-gray-500">Total Value (₹)</p>
                        <p id="total-value" class="text-3xl font-bold text-green-700 mt-1">0</p>
                    </div>
                </div>

                <!-- Low Stock Alerts -->
                <div id="low-stock-container" class="card-bg p-6 rounded-lg container-shadow">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Low Stock Alerts
                    </h2>
                    <p id="no-low-stock" class="text-center text-gray-500">No medicines are currently running low. Great job!</p>
                    <div id="low-stock-list" class="overflow-x-auto">
                        <!-- Low stock items will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Inventory Page Content -->
            <div id="inventory-page-content" class="page-content hidden">
                <header class="text-center md:text-left mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Inventory Management</h1>
                    <p class="mt-2 text-gray-600">Add, edit, and track your medicine stock.</p>
                </header>

                <!-- Form for adding/editing medicine -->
                <div class="card-bg p-6 rounded-lg container-shadow mb-8">
                    <h2 id="form-title" class="text-xl font-semibold text-gray-700 mb-4">Add New Medicine</h2>
                    <form id="medicine-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-end">
                        <input type="hidden" id="medicineId">
                        <div class="col-span-1">
                            <label for="medicineName" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" id="medicineName" name="medicineName" required class="w-full">
                        </div>
                        <div class="col-span-1">
                            <label for="medicineCategory" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="medicineCategory" name="medicineCategory" required class="w-full">
                                <option value="">Select Category</option>
                                <option value="Analgesic">Analgesic</option>
                                <option value="Antibiotic">Antibiotic</option>
                                <option value="Antihistamine">Antihistamine</option>
                                <option value="Anti-Diabetic">Anti-Diabetic</option>
                                <option value="Pain Reliever">Pain Reliever</option>
                                <option value="Antacid">Antacid</option>
                                <option value="Supplement">Supplement</option>
                                <option value="Pain Relief Gel">Pain Relief Gel</option>
                                <option value="Electrolytes">Electrolytes</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label for="medicineBatch" class="block text-sm font-medium text-gray-700 mb-1">Batch No.</label>
                            <input type="text" id="medicineBatch" name="medicineBatch" required class="w-full">
                        </div>
                        <div class="col-span-1">
                            <label for="medicineExpiry" class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                            <input type="date" id="medicineExpiry" name="medicineExpiry" required class="w-full">
                        </div>
                        <div class="col-span-1">
                            <label for="medicineStock" class="block text-sm font-medium text-gray-700 mb-1">Stock</label>
                            <input type="number" id="medicineStock" name="medicineStock" min="0" required class="w-full">
                        </div>
                        <div class="col-span-1">
                            <label for="medicineReorder" class="block text-sm font-medium text-gray-700 mb-1">Reorder Level</label>
                            <input type="number" id="medicineReorder" name="medicineReorder" min="0" required class="w-full">
                        </div>
                        <div class="col-span-1">
                            <label for="medicinePrice" class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
                            <input type="number" id="medicinePrice" name="medicinePrice" min="0.01" step="0.01" required class="w-full">
                        </div>
                        <div class="lg:col-span-2 xl:col-span-2 flex space-x-2 justify-end items-end">
                            <button type="submit" id="submitBtn" class="btn btn-primary w-full sm:w-auto">Add Medicine</button>
                            <button type="button" id="cancelBtn" class="btn btn-secondary w-full sm:w-auto hidden">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Medicine List -->
                <div class="card-bg p-6 rounded-lg container-shadow">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Current Stock</h2>
                    <input type="text" id="searchInput" placeholder="Search by medicine name..." class="w-full mb-4">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Batch No.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Expiry Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reorder Level</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price (₹)</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="medicine-list" class="bg-white divide-y divide-gray-200">
                                <!-- Medicine data will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <p id="no-medicines" class="mt-4 text-center text-gray-500 hidden">No medicines found. Add one above or adjust your search.</p>
                </div>
            </div>

            <!-- Sales Page Content -->
            <div id="sales-page-content" class="page-content hidden">
                <header class="text-center md:text-left mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Sales</h1>
                    <p class="mt-2 text-gray-600">Record and track sales transactions.</p>
                </header>
                
                <div class="card-bg p-6 rounded-lg container-shadow mb-8">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Record New Sale</h2>
                    <form id="sales-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 items-end">
                        <div class="col-span-1">
                            <label for="saleMedicine" class="block text-sm font-medium text-gray-700 mb-1">Medicine</label>
                            <select id="saleMedicine" name="saleMedicine" required class="w-full">
                                <option value="">Select Medicine</option>
                                <!-- Medicine options will be dynamically loaded here -->
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label for="salePrice" class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
                            <input type="number" id="salePrice" name="salePrice" readonly class="w-full bg-gray-200 cursor-not-allowed">
                        </div>
                        <div class="col-span-1">
                            <label for="saleQuantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                            <input type="number" id="saleQuantity" name="saleQuantity" min="1" required class="w-full">
                        </div>
                        <div class="col-span-1">
                            <label for="saleTotal" class="block text-sm font-medium text-gray-700 mb-1">Total (₹)</label>
                            <input type="number" id="saleTotal" name="saleTotal" readonly class="w-full bg-gray-200 cursor-not-allowed">
                        </div>
                        <button type="submit" class="btn btn-primary w-full lg:col-span-3">Record Sale</button>
                    </form>
                </div>

                <div class="card-bg p-6 rounded-lg container-shadow">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Sales History</h2>
                    <input type="text" id="salesSearchInput" placeholder="Search by name or date..." class="w-full mb-4">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medicine</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total (₹)</th>
                                </tr>
                            </thead>
                            <tbody id="sales-list" class="bg-white divide-y divide-gray-200">
                                <!-- Sales history will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Page Content -->
            <div id="reports-page-content" class="page-content hidden">
                <header class="text-center md:text-left mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Reports</h1>
                    <p class="mt-2 text-gray-600">Generate and view detailed reports.</p>
                </header>

                <div class="flex space-x-4 mb-8 justify-center md:justify-start">
                    <button id="sales-report-btn" class="btn btn-primary">Sales Report</button>
                    <button id="stock-report-btn" class="btn btn-secondary">Stock Report</button>
                </div>
                
                <!-- Sales Report Page -->
                <div id="sales-report-page" class="card-bg p-6 rounded-lg container-shadow text-center">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Sales Report</h2>
                    <div id="sales-report-table" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medicine</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity Sold</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Revenue (₹)</th>
                                </tr>
                            </thead>
                            <tbody id="sales-report-list" class="bg-white divide-y divide-gray-200">
                                <!-- Sales report data will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <p id="total-revenue-report" class="text-right mt-4 font-bold text-gray-700">Total Revenue: ₹0.00</p>
                </div>

                <!-- Stock Report Page -->
                <div id="stock-report-page" class="card-bg p-6 rounded-lg container-shadow hidden">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Stock Report</h2>
                    <div id="stock-report-table" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reorder Level</th>
                                </tr>
                            </thead>
                            <tbody id="stock-report-list" class="bg-white divide-y divide-gray-200">
                                <!-- Stock report data will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="user-info-bottom" class="mt-4 text-center text-sm font-semibold text-gray-500 bg-gray-100 p-2 rounded-lg inline-block md:hidden"></div>
        </main>
        
        <!-- Custom Modal for messages -->
        <div id="message-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 hidden">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full container-shadow">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modal-title" class="text-xl font-semibold text-gray-800"></h3>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors">&times;</button>
                </div>
                <p id="modal-message" class="text-gray-600 mb-4"></p>
                <button id="modal-ok-btn" class="btn btn-primary w-full">OK</button>
            </div>
        </div>
    </div>

    <script>
        const localStorageKey = 'medigo_app_data';
        
        const initialMedicines = [
            { id: 'med-paracetamol', name: 'Paracetamol 500mg', category: 'Analgesic', batch: 'B1023', expiry: '2026-12-01', stock: 150, reorderLevel: 50, price: 25 },
            { id: 'med-amoxicillin', name: 'Amoxicillin 250mg', category: 'Antibiotic', batch: 'A5678', expiry: '2025-06-01', stock: 80, reorderLevel: 30, price: 120 },
            { id: 'med-cetirizine', name: 'Cetirizine 10mg', category: 'Antihistamine', batch: 'C3345', expiry: '2027-09-01', stock: 200, reorderLevel: 70, price: 15 },
            { id: 'med-metformin', name: 'Metformin 500mg', category: 'Anti-Diabetic', batch: 'M2201', expiry: '2026-03-01', stock: 100, reorderLevel: 40, price: 60 },
            { id: 'med-ibuprofen', name: 'Ibuprofen 400mg', category: 'Pain Reliever', batch: 'I8976', expiry: '2025-07-01', stock: 60, reorderLevel: 20, price: 30 },
            { id: 'med-pantoprazole', name: 'Pantoprazole 40mg', category: 'Antacid', batch: 'P4455', expiry: '2027-02-01', stock: 90, reorderLevel: 30, price: 75 },
            { id: 'med-azithromycin', name: 'Azithromycin 500mg', category: 'Antibiotic', batch: 'Z7781', expiry: '2026-10-01', stock: 50, reorderLevel: 20, price: 140 },
            { id: 'med-vitaminC', name: 'Vitamin C 500mg', category: 'Supplement', batch: 'V3399', expiry: '2028-05-01', stock: 250, reorderLevel: 80, price: 10 },
            { id: 'med-diclofenac', name: 'Diclofenac Gel 1%', category: 'Pain Relief Gel', batch: 'D1122', expiry: '2026-01-01', stock: 120, reorderLevel: 40, price: 45 },
            { id: 'med-ors', name: 'ORS Sachet', category: 'Electrolytes', batch: 'O5566', expiry: '2025-11-01', stock: 180, reorderLevel: 60, price: 12 }
        ];

        const initialSales = [
            { id: 'sale1', medicineId: 'med-paracetamol', medicineName: 'Paracetamol 500mg', quantity: 10, total: 250, timestamp: new Date('2025-09-15') },
            { id: 'sale2', medicineId: 'med-amoxicillin', medicineName: 'Amoxicillin 250mg', quantity: 5, total: 600, timestamp: new Date('2025-09-16') },
            { id: 'sale3', medicineId: 'med-cetirizine', medicineName: 'Cetirizine 10mg', quantity: 20, total: 300, timestamp: new Date('2025-09-17') },
            { id: 'sale4', medicineId: 'med-metformin', medicineName: 'Metformin 500mg', quantity: 10, total: 600, timestamp: new Date('2025-09-18') },
            { id: 'sale5', medicineId: 'med-ibuprofen', medicineName: 'Ibuprofen 400mg', quantity: 15, total: 450, timestamp: new Date('2025-09-19') },
        ];
        
        let allMedicines = [];
        let allSales = [];
        let currentUser = null;

        const landingPage = document.getElementById('landing-page');
        const signupPage = document.getElementById('signup-page');
        const loginPage = document.getElementById('login-page');
        const mainApp = document.getElementById('main-app');
        const signupPageBtn = document.getElementById('signup-page-btn');
        const loginPageBtn = document.getElementById('login-page-btn');
        const signupForm = document.getElementById('signup-form');
        const loginForm = document.getElementById('login-form');
        const logoutBtn = document.getElementById('logout-btn');
        const pageContents = document.querySelectorAll('.page-content');
        const navItems = document.querySelectorAll('.nav-item');
        const medicineForm = document.getElementById('medicine-form');
        const medicineList = document.getElementById('medicine-list');
        const medicineIdInput = document.getElementById('medicineId');
        const medicineNameInput = document.getElementById('medicineName');
        const medicineCategoryInput = document.getElementById('medicineCategory');
        const medicineBatchInput = document.getElementById('medicineBatch');
        const medicineExpiryInput = document.getElementById('medicineExpiry');
        const medicineStockInput = document.getElementById('medicineStock');
        const medicineReorderInput = document.getElementById('medicineReorder');
        const medicinePriceInput = document.getElementById('medicinePrice');
        const submitBtn = document.getElementById('submitBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const formTitle = document.getElementById('form-title');
        const noMedicinesEl = document.getElementById('no-medicines');
        const searchInput = document.getElementById('searchInput');
        const salesForm = document.getElementById('sales-form');
        const saleMedicineSelect = document.getElementById('saleMedicine');
        const salePriceInput = document.getElementById('salePrice');
        const saleQuantityInput = document.getElementById('saleQuantity');
        const saleTotalInput = document.getElementById('saleTotal');
        const salesList = document.getElementById('sales-list');
        const salesSearchInput = document.getElementById('salesSearchInput');
        const salesReportList = document.getElementById('sales-report-list');
        const totalRevenueReportEl = document.getElementById('total-revenue-report');
        const stockReportList = document.getElementById('stock-report-list');
        const totalMedicinesEl = document.getElementById('total-medicines');
        const totalStockEl = document.getElementById('total-stock');
        const totalValueEl = document.getElementById('total-value');
        const lowStockListEl = document.getElementById('low-stock-list');
        const noLowStockEl = document.getElementById('no-low-stock');
        const modal = document.getElementById('message-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('close-modal-btn');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        const salesReportBtn = document.getElementById('sales-report-btn');
        const stockReportBtn = document.getElementById('stock-report-btn');
        const salesReportPage = document.getElementById('sales-report-page');
        const stockReportPage = document.getElementById('stock-report-page');

        function showModal(title, message, okCallback = null) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
            modalOkBtn.onclick = () => {
                hideModal();
                if (okCallback) okCallback();
            };
        }

        function hideModal() {
            modal.classList.add('hidden');
        }

        modalCloseBtn.addEventListener('click', hideModal);

        function saveAppState() {
            const appState = {
                medicines: allMedicines,
                sales: allSales,
                user: currentUser
            };
            localStorage.setItem(localStorageKey, JSON.stringify(appState));
        }

        function loadAppState() {
            const storedState = localStorage.getItem(localStorageKey);
            if (storedState) {
                const appState = JSON.parse(storedState);
                allMedicines = appState.medicines || [];
                allSales = appState.sales.map(sale => ({ ...sale, timestamp: new Date(sale.timestamp) })) || [];
                currentUser = appState.user;
            } else {
                allMedicines = JSON.parse(JSON.stringify(initialMedicines));
                allSales = initialSales.map(sale => ({ ...sale, timestamp: new Date(sale.timestamp) }));
                saveAppState();
            }
        }
        
        function resetForm() {
            medicineForm.reset();
            medicineIdInput.value = '';
            submitBtn.textContent = 'Add Medicine';
            formTitle.textContent = 'Add New Medicine';
            cancelBtn.classList.add('hidden');
        }

        function renderMedicines(medicines) {
            medicineList.innerHTML = '';
            if (medicines.length === 0) {
                noMedicinesEl.classList.remove('hidden');
            } else {
                noMedicinesEl.classList.add('hidden');
                medicines.forEach(med => {
                    const row = document.createElement('tr');
                    const isLowStock = med.stock <= med.reorderLevel;
                    row.className = `hover:bg-gray-50 ${isLowStock ? 'bg-red-50' : ''}`;
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${med.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${med.category || 'N/A'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${med.batch}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${med.expiry}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${med.stock}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${med.reorderLevel}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${med.price.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                            <button class="btn-sm btn-primary py-2 px-3 rounded-lg text-sm" onclick="editMedicine('${med.id}')">Edit</button>
                            <button class="btn-sm btn-danger py-2 px-3 rounded-lg text-sm" onclick="deleteMedicine('${med.id}')">Delete</button>
                        </td>
                    `;
                    medicineList.appendChild(row);
                });
            }
        }
        
        function renderLowStock(medicines) {
            const lowStockItems = medicines.filter(med => med.stock <= med.reorderLevel);
            lowStockListEl.innerHTML = '';
            if (lowStockItems.length === 0) {
                noLowStockEl.classList.remove('hidden');
            } else {
                noLowStockEl.classList.add('hidden');
                lowStockItems.forEach(med => {
                    const div = document.createElement('div');
                    div.className = 'bg-red-100 border border-red-200 text-red-700 p-4 rounded-lg flex items-center mb-2';
                    div.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>${med.name} stock is at **${med.stock}**. Reorder level is **${med.reorderLevel}**.</span>
                    `;
                    lowStockListEl.appendChild(div);
                });
            }
        }
        
        function renderSales(sales) {
            salesList.innerHTML = '';
            if (sales.length === 0) {
                salesList.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500 py-4">No sales found.</td></tr>';
            } else {
                sales.sort((a, b) => b.timestamp - a.timestamp);
                sales.forEach(sale => {
                    const row = document.createElement('tr');
                    const date = new Date(sale.timestamp).toLocaleDateString();
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${sale.medicineName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.quantity}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${sale.total.toFixed(2)}</td>
                    `;
                    salesList.appendChild(row);
                });
            }
        }
        
        function populateSalesDropdown(medicines) {
            saleMedicineSelect.innerHTML = '<option value="">Select Medicine</option>';
            medicines.forEach(med => {
                const option = document.createElement('option');
                option.value = med.id;
                option.textContent = `${med.name}`;
                option.dataset.price = med.price;
                option.dataset.stock = med.stock;
                saleMedicineSelect.appendChild(option);
            });
        }

        function renderSalesReport(sales) {
            salesReportList.innerHTML = '';
            const salesSummary = sales.reduce((acc, sale) => {
                const medName = sale.medicineName;
                if (!acc[medName]) {
                    acc[medName] = { quantity: 0, total: 0 };
                }
                acc[medName].quantity += sale.quantity;
                acc[medName].total += sale.total;
                return acc;
            }, {});

            let totalRevenue = 0;
            for (const med in salesSummary) {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${med}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${salesSummary[med].quantity}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${salesSummary[med].total.toFixed(2)}</td>
                `;
                salesReportList.appendChild(row);
                totalRevenue += salesSummary[med].total;
            }

            totalRevenueReportEl.textContent = `Total Revenue: ₹${totalRevenue.toFixed(2)}`;
        }

        function renderStockReport(medicines) {
            stockReportList.innerHTML = '';
            medicines.forEach(med => {
                const row = document.createElement('tr');
                const isLowStock = med.stock <= med.reorderLevel;
                row.className = `hover:bg-gray-50 ${isLowStock ? 'bg-red-50 font-bold' : ''}`;
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${med.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${med.stock}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${med.reorderLevel}</td>
                `;
                stockReportList.appendChild(row);
            });
        }

        function updateDashboard(medicines, sales) {
            const totalItems = medicines.length;
            const totalStock = medicines.reduce((sum, med) => sum + (med.stock || 0), 0);
            const totalValue = medicines.reduce((sum, med) => sum + (med.stock * med.price || 0), 0);
            
            totalMedicinesEl.textContent = totalItems;
            totalStockEl.textContent = totalStock;
            totalValueEl.textContent = totalValue.toFixed(2);
            
            renderLowStock(medicines);
            populateSalesDropdown(medicines);
            renderSalesReport(sales);
            renderStockReport(medicines);
        }

        function showPage(pageId) {
            const pages = {
                'landing-page': landingPage,
                'signup-page': signupPage,
                'login-page': loginPage,
                'main-app': mainApp,
            };

            for (const key in pages) {
                if (key === pageId) {
                    pages[key].classList.remove('hidden');
                } else {
                    pages[key].classList.add('hidden');
                }
            }

            if (pageId === 'main-app') {
                updateDashboard(allMedicines, allSales);
            }
        }

        function handlePageLoad() {
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                loadAppState();
                showPage('main-app');
            } else {
                showPage('landing-page');
            }
        }

        window.onload = handlePageLoad;

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                if (item.dataset.page) {
                    document.querySelectorAll('.page-content').forEach(page => page.classList.add('hidden'));
                    document.getElementById(`${item.dataset.page}-page-content`).classList.remove('hidden');
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                }
            });
        });

        signupPageBtn.addEventListener('click', () => showPage('signup-page'));
        loginPageBtn.addEventListener('click', () => showPage('login-page'));

        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const password = document.getElementById('signup-password').value;
            
            const existingUser = localStorage.getItem('currentUser');
            if (existingUser) {
                showModal('Error', 'An account already exists. Please log in.');
                return;
            }

            const newUser = { name, password };
            localStorage.setItem('currentUser', JSON.stringify(newUser));

            allMedicines = JSON.parse(JSON.stringify(initialMedicines));
            allSales = initialSales.map(sale => ({ ...sale, timestamp: new Date(sale.timestamp) }));
            saveAppState();
            
            showModal('Success', 'Account created successfully! You are now logged in.', () => {
                showPage('main-app');
            });
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('login-name').value;
            const password = document.getElementById('login-password').value;
            
            const storedUser = JSON.parse(localStorage.getItem('currentUser'));

            if (storedUser && storedUser.name === name && storedUser.password === password) {
                loadAppState();
                showModal('Success', 'Logged in successfully!', () => {
                    showPage('main-app');
                });
            } else {
                showModal('Error', 'Invalid name or password. Please try again.');
            }
        });

        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            showPage('landing-page');
            showModal('Logged Out', 'You have been logged out successfully.');
        });
        
        medicineForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const name = medicineNameInput.value.trim();
            const category = medicineCategoryInput.value;
            const batch = medicineBatchInput.value.trim();
            const expiry = medicineExpiryInput.value;
            const stock = parseInt(medicineStockInput.value, 10);
            const reorderLevel = parseInt(medicineReorderInput.value, 10);
            const price = parseFloat(medicinePriceInput.value);

            if (!name || isNaN(stock) || isNaN(price) || !category || !batch || !expiry || isNaN(reorderLevel)) {
                showModal('Validation Error', 'Please fill in all fields with valid data.');
                return;
            }

            const medicineId = medicineIdInput.value;
            if (medicineId) {
                const index = allMedicines.findIndex(med => med.id === medicineId);
                if (index !== -1) {
                    allMedicines[index] = { ...allMedicines[index], name, category, batch, expiry, stock, reorderLevel, price };
                    showModal('Success', 'Medicine updated successfully!');
                }
            } else {
                const newId = 'med-' + crypto.randomUUID();
                allMedicines.push({ id: newId, name, category, batch, expiry, stock, reorderLevel, price });
                showModal('Success', 'Medicine added successfully!');
            }
            saveAppState();
            updateDashboard(allMedicines, allSales);
            filterMedicines();
            resetForm();
        });
        
        salesForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const selectedOption = saleMedicineSelect.options[saleMedicineSelect.selectedIndex];
            const medicineId = selectedOption.value;
            const medicineName = selectedOption.textContent;
            const quantity = parseInt(saleQuantityInput.value, 10);
            const medicinePrice = parseFloat(selectedOption.dataset.price);
            const currentStock = parseInt(selectedOption.dataset.stock, 10);

            if (!medicineId || isNaN(quantity) || quantity <= 0) {
                showModal('Validation Error', 'Please select a medicine and enter a valid quantity.');
                return;
            }

            if (quantity > currentStock) {
                showModal('Stock Error', 'The quantity exceeds the current stock. Please enter a lower amount.');
                return;
            }

            const total = quantity * medicinePrice;
            const newStock = currentStock - quantity;

            const medIndex = allMedicines.findIndex(med => med.id === medicineId);
            if (medIndex !== -1) {
                allMedicines[medIndex].stock = newStock;
            }

            allSales.push({ id: 'sale-' + crypto.randomUUID(), medicineId, medicineName, quantity, total, timestamp: new Date() });
            
            saveAppState();
            updateDashboard(allMedicines, allSales);
            showModal('Sale Recorded', `Sale of ${quantity} unit(s) of ${medicineName} for ₹${total.toFixed(2)} recorded.`);
            salesForm.reset();
            salePriceInput.value = '';
            saleTotalInput.value = '';
        });
        
        window.editMedicine = (id) => {
            showPage('main-app');
            document.getElementById('inventory-page-content').classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-page="inventory"]').classList.add('active');

            const medToEdit = allMedicines.find(med => med.id === id);
            if (medToEdit) {
                medicineIdInput.value = medToEdit.id;
                medicineNameInput.value = medToEdit.name;
                medicineCategoryInput.value = medToEdit.category || '';
                medicineBatchInput.value = medToEdit.batch || '';
                medicineExpiryInput.value = medToEdit.expiry || '';
                medicineStockInput.value = medToEdit.stock;
                medicineReorderInput.value = medToEdit.reorderLevel || 0;
                medicinePriceInput.value = medToEdit.price;
                submitBtn.textContent = 'Update Medicine';
                formTitle.textContent = 'Edit Medicine';
                cancelBtn.classList.remove('hidden');
            }
        };

        window.deleteMedicine = (id) => {
            showModal('Confirm Deletion', 'Are you sure you want to delete this medicine?');
            
            modalOkBtn.onclick = () => {
                hideModal();
                allMedicines = allMedicines.filter(med => med.id !== id);
                saveAppState();
                updateDashboard(allMedicines, allSales);
                showModal('Success', 'Medicine deleted successfully!');
            };
        };

        cancelBtn.addEventListener('click', (e) => {
            e.preventDefault();
            resetForm();
        });
        
        salesReportBtn.addEventListener('click', () => {
            salesReportPage.classList.remove('hidden');
            stockReportPage.classList.add('hidden');
            salesReportBtn.classList.remove('btn-secondary');
            salesReportBtn.classList.add('btn-primary');
            stockReportBtn.classList.remove('btn-primary');
            stockReportBtn.classList.add('btn-secondary');
        });

        stockReportBtn.addEventListener('click', () => {
            salesReportPage.classList.add('hidden');
            stockReportPage.classList.remove('hidden');
            stockReportBtn.classList.remove('btn-secondary');
            stockReportBtn.classList.add('btn-primary');
            salesReportBtn.classList.remove('btn-primary');
            salesReportBtn.classList.add('btn-secondary');
        });
        
        searchInput.addEventListener('input', () => renderMedicines(allMedicines.filter(med => med.name.toLowerCase().includes(searchInput.value.toLowerCase()))));
        salesSearchInput.addEventListener('input', () => renderSales(allSales.filter(sale => sale.medicineName.toLowerCase().includes(salesSearchInput.value.toLowerCase()) || new Date(sale.timestamp).toLocaleDateString().includes(salesSearchInput.value))));
        
        function updateSaleTotals() {
            const selectedOption = saleMedicineSelect.options[saleMedicineSelect.selectedIndex];
            const price = selectedOption.value ? parseFloat(selectedOption.dataset.price) : 0;
            const quantity = parseInt(saleQuantityInput.value, 10) || 0;
            
            salePriceInput.value = price.toFixed(2);
            saleTotalInput.value = (price * quantity).toFixed(2);
        }

        saleMedicineSelect.addEventListener('change', updateSaleTotals);
        saleQuantityInput.addEventListener('input', updateSaleTotals);
    </script>
</body>
</html>
